from flask import Flask, request, render_template

import logging
import os
import os.path
import re

app = Flask(
	__name__,            
	static_folder='static',
    	template_folder='templates'
)

app.logger.setLevel(logging.INFO)

def chrome_version():
    ua = request.headers.get('User-Agent')
    match = re.search('Mozilla\/5\.0 \(X11; Linux x86_64\) AppleWebKit\/\d+\.\d+ \(KHTML, like Gecko\) Chrome\/(\d+\.\d+\.\d+\.\d+) Safari\/\d+\.\d+', ua)
    if match is not None:
        return 'lin_' + match.group(1)
    match = re.search('Mozilla\/5\.0 \(Windows NT 10\.0; Win64; x64\) AppleWebKit\/\d+\.\d+ \(KHTML, like Gecko\) Chrome\/(\d+\.\d+\.\d+\.\d+) Safari\/\d+\.\d+', ua)
    if match is not None:
        return 'win_' + match.group(1)
    return False

@app.route('/')
def index():
    file = request.args.get('file')
    version = chrome_version()
    if version == False:
        return '<html><body><div>I can\'t find the chrome version from UA?...</div></body></html>'
    else:
        app.logger.info("[*] Detected version {}".format(version))
        return render_template("{}/index.html".format(version))

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8082)
