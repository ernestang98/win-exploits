# How to build V8

### Windows

1. Download depot tools

2. Add depot tools path to the FRONT of your PATH environmental variable

3. Create DEPOT_TOOLS_WIN_TOOLCHAIN environmental variable and set it to 0

4. Create vs????_install variable and set it to the installation path to your MSVC

    - MSVC 2017 settings which was used in [Jack Halon's blog](https://jhalon.github.io/chrome-browser-exploitation-3/) allowed me to smoothly build d8.exes until 12.2.XXXX (may work for more versions but never tried, also you may have to uninstall/install older/newer Windows SDK versions). Does NOT work for latest d8 version which is 12.7.XXXX as of at this point in time (need to use MSVC 2022).

    - MSVC 2022 may not work for older builds of d8.exe but it certainly works for newer ones (it can be used to build 11.4.XXXX so with both MSVC 2022 and MSVC 2017, you should be able to build most V8s from 2018 to now (2024))

    - You may also need to change the version of depot tools itself based on the version of d8 you are building

        ```
        COMMIT_DATE=$(git show -s --format=%cd --date=format:'%Y-%m-%d')
        git checkout $(git rev-list -n 1 --before="$COMMIT_DATE" master)
        ```

5. Install the appropriate version of Windows SDK. Below is an example of logs which will indicate that you don't have the correct version of Windows SDK installed. Download them from [microsoft](https://developer.microsoft.com/en-us/windows/downloads/sdk-archive/) other various sources (e.g. Google, Archive.org).

    ```
    Traceback (most recent call last):
    File "C:\chromium\src\build\vs_toolchain.py", line 573, in <module>
        sys.exit(main())
                ^^^^^^
    File "C:\chromium\src\build\vs_toolchain.py", line 569, in main
        return commands[sys.argv[1]](*sys.argv[2:])
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\chromium\src\build\vs_toolchain.py", line 400, in CopyDlls
        _CopyDebugger(target_dir, target_cpu)
    File "C:\chromium\src\build\vs_toolchain.py", line 433, in _CopyDebugger
        raise Exception('%s not found in "%s"\r\nYou must install'
    Exception: api-ms-win-downlevel-kernel32-l2-1-0.dll not found in "C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\api-ms-win-downlevel-kernel32-l2-1-0.dll"
    You must installWindows 10 SDK version 10.0.19041.0 including the "Debugging Tools for Windows" feature.
    ```

6. Fix any miscellaneous errors (such as incompatible python3 versions). Google/ChatGPT before sequentially resolving them

7. Run `gclient` (make sure no errors)

8. Run `mkdir v8 ; cd v8 ; fetch v8`

9. Run `cd v8`  (your path should be something like C:\v8\v8)

10. Run `gclient sync -D`

11. Run `gn gen --ide=vs out\x64.debug` / `gn gen out\x64.debug`

12. Run x64 Native Tools Command Prompt and execute `cd C:\v8\v8\out\x64.debug` 

13. Run `msbuild all.sln`

    - Run `ninja -C out\x64.debug d8` or `autoninja -C out\x64.debug d8` to just build d8

14. Edit args.gn appropriately and accordingly

### Linux & Android (On Ubuntu 22.04)

1. Run `git clone depot_tools` (e.g. /home/user/depot_tools)

2. Add path to depot_tools (e.g. `PATH=/home/user/depot_tools:$PATH`)

3. Run `mkdir v8 && cd v8 && fetch v8`

4. Run `echo "target_os = ['android', 'unix']" >> .gclient`

5. Run `./build/install-build-deps.sh --android` and `./build/install-build-deps.sh `

6. Run `gclient sync`

7. Checkout to the particular version of V8 you desire and run gclient sync again

8. Run `./tools/dev/gm.py x64.release` or `gn gen out/x64.release`

9. Edits args.gn appropriately and accordingly

10. Lowest possible build for me is 11.0.1 using 776298987617eb544c5ef03bc8e67c7f2d0fdcbc version of depot_tools as of 9th August 2024, 20:23:54. If you want to build older versions of V8, I suggest to try on a older version of Ubuntu and also adjust the version of depot_tools accordingly.

# How to build chrome 

### Windows/Linux/Android

1. Environment setup similar to building v8 (as for steps just refer to Chromium documentation)

2. Do NOT run `fetch chromium` (you will run into some network issues cause chromium has far too many commits...), instead run the following commands:

    ```
    fetch --nohistory chromium 
    git fetch --tags
    ```

# References

- [args.gn](https://www.chromium.org/developers/gn-build-configuration/)

- [cross compiling arm](https://v8.dev/docs/cross-compile-arm)

- [building v8](https://v8.dev/docs/build)

- [chromium * build instructions](https://chromium.googlesource.com/chromium/src/+/main/docs/*_build_instructions.md)

- [Random script which can be useful](https://gist.github.com/revmischa/cd299db577af73965ef96ee6dbd1deca)

- [Another random script which can be useful](https://github.com/Ravbug/chromiumbuild/blob/master/chromiumbuild_win.bat)

- [Another another random script which can be useful](https://github.com/porkycode/Chromium-Windows-Build)

- [Nice guy that builds and releases chromium](https://github.com/Hibbiki/chromium-win64)

- [MSVC 2013 LMAO](https://gist.github.com/qrealka/0aa39d850310d02ced2dd71a95ae6b0f)

- [Linux guide](https://gist.github.com/kennwhite/b05fcdd2161688c1e859f962ec90c4f4)

- [Windows guide](https://sinclairinat0r.com/2019/04/29/building-chromium-on-windows-from-source)

- [Android guide](https://andreasch.com/2019/01/29/build-chromium-android/)
