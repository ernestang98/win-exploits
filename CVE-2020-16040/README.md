# CVE-2020-16040

Chrome 71.0.3578.98

### Commands

```
"C:\Users\kali\AppData\Local\Google\Chrome\Application\chrome.exe" --no-sandbox --js-flags="--allow-natives-syntax" --enable-logging --v=1
```

### DebugPrints, Relative Reads & WinDBG

```
...
0x3ff199999999999a
0x400199999999999a
0x400a666666666666
0x80406e108241889
0xc808127cf5
0x4080404a9
0x8127d1508127ce5
0x80406e1082418d9
0x408127d25
0x80406e108241e01
...

0:000> dd 0x00d008127cf5-1
000000d0`08127cf4  08040a0d 00000006 9999999a 3ff19999
000000d0`08127d04  9999999a 40019999 66666666 400a6666
000000d0`08127d14  08241889 080406e1 08127cf5 000000c8
000000d0`08127d24  080404a9 00000004 08127ce5 08127d15
000000d0`08127d34  082418d9 080406e1 08127d25 00000004
000000d0`08127d44  08241e01 080406e1 080406e1 08127d35
000000d0`08127d54  00000004 00000002 08040e1d 00000008
000000d0`08127d64  00000004 00000000 08241e2b 08040305

DebugPrint: 000000D008127D15: [JSArray] //
 - map: 0x00d008241889 <Map(PACKED_DOUBLE_ELEMENTS)> [FastProperties]
 - prototype: 0x00d008208d75 <JSArray[0]>
 - elements: 0x00d008127cf5 <FixedDoubleArray[3]> [PACKED_DOUBLE_ELEMENTS]
 - length: 100
 - properties: 0x00d0080406e1 <FixedArray[0]> {
    #length: 0x00d00818015d <AccessorInfo> (const accessor descriptor)
 }
 - elements: 0x00d008127cf5 <FixedDoubleArray[3]> {
           0: 1.1
           1: 2.2
           2: 3.3
 }
000000D008241889: [Map]
 - type: JS_ARRAY_TYPE
 - instance size: 16
 - inobject properties: 0
 - elements kind: PACKED_DOUBLE_ELEMENTS
 - unused property fields: 0
 - enum length: invalid
 - back pointer: 0x00d008241861 <Map(HOLEY_SMI_ELEMENTS)>
 - prototype_validity cell: 0x00d008180449 <Cell value= 1>
 - instance descriptors #1: 0x00d0082093f9 <DescriptorArray[1]>
 - transitions #1: 0x00d008209445 <TransitionArray[4]>Transition array #1:
     0x00d008042ea1 <Symbol: (elements_transition_symbol)>: (transition to HOLEY_DOUBLE_ELEMENTS) -> 0x00d0082418b1 <Map(HOLEY_DOUBLE_ELEMENTS)>

 - prototype: 0x00d008208d75 <JSArray[0]>
 - constructor: 0x00d008208c49 <JSFunction Array (sfi = 000000D008188E35)>
 - dependent code: 0x00d0080401e5 <Other heap object (WEAK_FIXED_ARRAY_TYPE)>
 - construction counter: 0

DebugPrint: 000000D008127CE5: [JSArray] // -1 Array
 - map: 0x00d008241861 <Map(HOLEY_SMI_ELEMENTS)> [FastProperties]
 - prototype: 0x00d008208d75 <JSArray[0]>
 - elements: 0x00d008127cd9 <FixedArray[67240382]> [HOLEY_SMI_ELEMENTS]
 - length: -1
 - properties: 0x00d0080406e1 <FixedArray[0]> {
    #length: 0x00d00818015d <AccessorInfo> (const accessor descriptor)
 }
 - elements: 0x00d008127cd9 <FixedArray[67240382]> {
           0: 0x00d00804037d <the_hole>
           1: 0x00d008241861 <Map(HOLEY_SMI_ELEMENTS)>
           2: 0x00d0080406e1 <FixedArray[0]>
           3: 0x00d008127cd9 <FixedArray[67240382]>
           4: -1
           5: 0x00d008040a0d <Map>
           6: 3
           7: -858993459
           8: 0x00d03ff19999
```

```
0:000> dd 000001C40808A355-1
000001c4`0808a354  08241861 080406e1 0808a349 fffffffe
000001c4`0808a364  08040a0d 00000006 9999999a 3ff19999
000001c4`0808a374  9999999a 40019999 66666666 400a6666
000001c4`0808a384  08241889 080406e1 0808a365 00000002
000001c4`0808a394  080404a9 00000004 0808a355 0808a385
000001c4`0808a3a4  082418d9 080406e1 0808a395 00000004
000001c4`0808a3b4  08241e01 080406e1 080406e1 0808a3a5
000001c4`0808a3c4  00000004 00000002 08040e1d 00000008
0:000> dd 0x01c40808a349-1
000001c4`0808a348  080404a9 0804037d 0804037d 08241861
000001c4`0808a358  080406e1 0808a349 fffffffe 08040a0d
000001c4`0808a368  00000006 9999999a 3ff19999 9999999a
000001c4`0808a378  40019999 66666666 400a6666 08241889
000001c4`0808a388  080406e1 0808a365 00000002 080404a9
000001c4`0808a398  00000004 0808a355 0808a385 082418d9
000001c4`0808a3a8  080406e1 0808a395 00000004 08241e01
000001c4`0808a3b8  080406e1 080406e1 0808a3a5 00000004

DebugPrint: 000001C40808A385: [JSArray]
 - map: 0x01c408241889 <Map(PACKED_DOUBLE_ELEMENTS)> [FastProperties]
 - prototype: 0x01c408208d75 <JSArray[0]>
 - elements: 0x01c40808a365 <FixedDoubleArray[3]> [PACKED_DOUBLE_ELEMENTS]
 - length: 1
 - properties: 0x01c4080406e1 <FixedArray[0]> {
    #length: 0x01c40818015d <AccessorInfo> (const accessor descriptor)
 }
 - elements: 0x01c40808a365 <FixedDoubleArray[3]> {
           0: 1.1
           1: 2.2
           2: 3.3
 }
000001C408241889: [Map]
 - type: JS_ARRAY_TYPE
 - instance size: 16
 - inobject properties: 0
 - elements kind: PACKED_DOUBLE_ELEMENTS
 - unused property fields: 0
 - enum length: invalid
 - back pointer: 0x01c408241861 <Map(HOLEY_SMI_ELEMENTS)>
 - prototype_validity cell: 0x01c408180449 <Cell value= 1>
 - instance descriptors #1: 0x01c4082093f9 <DescriptorArray[1]>
 - transitions #1: 0x01c408209445 <TransitionArray[4]>Transition array #1:
     0x01c408042ea1 <Symbol: (elements_transition_symbol)>: (transition to HOLEY_DOUBLE_ELEMENTS) -> 0x01c4082418b1 <Map(HOLEY_DOUBLE_ELEMENTS)>

 - prototype: 0x01c408208d75 <JSArray[0]>
 - constructor: 0x01c408208c49 <JSFunction Array (sfi = 000001C408188E35)>
 - dependent code: 0x01c4080401e5 <Other heap object (WEAK_FIXED_ARRAY_TYPE)>
 - construction counter: 0
DebugPrint: 000001C40808A355: [JSArray]
 - map: 0x01c408241861 <Map(HOLEY_SMI_ELEMENTS)> [FastProperties]
 - prototype: 0x01c408208d75 <JSArray[0]>
 - elements: 0x01c40808a349 <FixedArray[67240382]> [HOLEY_SMI_ELEMENTS]
 - length: -1
 - properties: 0x01c4080406e1 <FixedArray[0]> {
    #length: 0x01c40818015d <AccessorInfo> (const accessor descriptor)
 }
 - elements: 0x01c40808a349 <FixedArray[67240382]> {
           0: 0x01c40804037d <the_hole>
           1: 0x01c408241861 <Map(HOLEY_SMI_ELEMENTS)>
           2: 0x01c4080406e1 <FixedArray[0]>
           3: 0x01c40808a349 <FixedArray[67240382]>
           4: -1
           5: 0x01c408040a0d <Map>
           6: 3
           7: -858993459
           8: 0x01c43ff19999
```

### References

- [Exploit by anvbis](https://github.com/anvbis/chrome_v8_ndays/blob/master/cve-2020-16040.js)

- [Exploit by r4j0x00](https://github.com/r4j0x00/exploits/blob/master/CVE-2020-16040/exploit.js)

- [Exploit Writeup by homecrew.dev](https://homecrew.dev/posts/cve-2020-16040.html)

- [RCA by faraz.faith](https://homecrew.dev/posts/cve-2020-16040.html)

- [RCA by some chinese website](https://static.anquanke.com/download/b/security-geek-2021-q1/article-15.html)